# Telegram Radio Bot - Two-Way Communication

Бот для двусторонней связи между Telegram и радиостанцией в режиме VOX.

## Функциональность

1. **Прием сообщений из Telegram**: Получает голосовые сообщения из Telegram и воспроизводит их через динамики, подключенные к радиостанции
2. **Отправка сообщений в Telegram**: Записывает аудио с микрофона (радиостанция) при обнаружении сигнала (VOX) и отправляет голосовые сообщения в Telegram

## Требования

- Python 3.8+
- FFmpeg (для воспроизведения и конвертации аудио)
- PyAudio (для работы с микрофоном)
- Доступ к Telegram Bot API

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Установите FFmpeg:
   - Windows: Скачайте с https://ffmpeg.org/download.html и добавьте в PATH
   - Linux: `sudo apt-get install ffmpeg`
   - macOS: `brew install ffmpeg`

3. Настройте `config.json`:
```json
{
    "token": "YOUR_TELEGRAM_BOT_TOKEN"
}
```

## Настройка

### VOX параметры (в файле `tg-reader.py`):

- `VOX_THRESHOLD` (по умолчанию: 500) - Порог активации VOX. Увеличьте значение, если бот реагирует на шум, уменьшите, если не реагирует на сигнал
- `VOX_SILENCE_TIME` (по умолчанию: 1.0) - Время тишины в секундах перед остановкой записи
- `INPUT_DEVICE_INDEX` (по умолчанию: None) - Индекс аудио устройства. None = устройство по умолчанию

### Аудио параметры:

- `AUDIO_RATE` (по умолчанию: 44100) - Частота дискретизации
- `AUDIO_CHANNELS` (по умолчанию: 1) - Количество каналов (1 = моно)
- `VOLUME` (по умолчанию: 2.0) - Усиление входящих голосовых сообщений

## Использование

1. Запустите скрипт:
```bash
python tg-reader.py
```

2. При запуске будет показан список доступных аудио устройств. Если нужно использовать конкретное устройство, установите `INPUT_DEVICE_INDEX` на соответствующий индекс.

3. Отправьте голосовое сообщение боту в Telegram - оно будет воспроизведено через динамики.

4. Когда на микрофоне появится сигнал выше порога VOX, начнется запись. После окончания сигнала (тишина более `VOX_SILENCE_TIME` секунд), запись остановится и сообщение будет отправлено в Telegram.

## Настройка VOX порога

Если бот не реагирует на сигнал или реагирует на шум:

1. Запустите скрипт и наблюдайте за выводом в консоли
2. При активации VOX будет выводиться уровень сигнала: `VOX активирован (уровень: XXX)`
3. Настройте `VOX_THRESHOLD` на основе этих значений:
   - Если уровень сигнала 1000-2000, установите порог около 800-1000
   - Оставьте запас для надежной работы

## Примечания

- Бот сохраняет chat_id всех пользователей, отправивших ему сообщения, и будет отправлять записи с радиостанции всем этим пользователям
- Временные файлы автоматически удаляются после обработки
- Для работы требуется стабильное интернет-соединение для связи с Telegram API




